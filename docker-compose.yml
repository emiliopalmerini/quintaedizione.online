services:
  mongo:
    image: mongo:8
    container_name: dnd-mongo
    restart: unless-stopped
    ports: ["27017:27017"]
    volumes:
      - mongo_data:/data/db
      - ./seed:/seed:ro
      - ./seed/init:/docker-entrypoint-initdb.d:ro

  srd-tui:
    build:
      context: ./srd_parser
      dockerfile: Dockerfile.Parser
    container_name: dnd-srd-tui
    depends_on: [mongo]
    environment:
      - MONGO_URI=mongodb://mongo:27017
      - DB_NAME=dnd
      - INPUT_DIR=/data
      - SOURCE_LABEL=srd 5.2.1
    volumes:
      - ./data:/data:ro
    stdin_open: true
    tty: true

  editor:
    build:
      context: ./editor
      dockerfile: Dockerfile.Editor
    container_name: dnd-editor
    depends_on: [mongo]
    environment:
      - MONGO_URI=mongodb://mongo:27017
      - DB_NAME=dnd
    ports: ["8000:8000"]
    restart: unless-stopped

volumes:
  mongo_data:
