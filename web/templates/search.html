{{define "title"}}{{.title}}{{end}}

{{define "content"}}
<div class="notion-page">
  <div class="notion-page-header">
    <h1 style="color: var(--notion-text); font-size: 2rem; font-weight: 600; margin: 0;">
      {{.title}}
    </h1>
    {{if .query}}
    <p style="color: var(--notion-text-light); margin-top: 0.5rem;">
      Risultati per "{{.query}}"{{if .resultCount}} ({{.resultCount}} trovati){{end}}
    </p>
    {{end}}
  </div>

  <!-- Search form -->
  <div class="search-section" style="margin-bottom: 2rem;">
    <form hx-post="/search" hx-target="#search-results" hx-trigger="submit" class="search-form">
      <div class="search-input-container">
        <input name="q" type="text" placeholder="Cerca nel SRD..." 
               value="{{.query}}" class="field" style="flex: 1; margin-right: 10px;" required>
        <button type="submit" class="btn btn-primary">Cerca</button>
      </div>
      
      <!-- Collection filters -->
      <div class="search-filters" style="margin-top: 1rem;">
        <label style="color: var(--notion-text); font-weight: 500; margin-bottom: 0.5rem; display: block;">
          Cerca in:
        </label>
        <div class="filter-checkboxes" style="display: flex; flex-wrap: wrap; gap: 1rem;">
          {{range $collection := slice "incantesimi" "mostri" "classi" "backgrounds" "equipaggiamento" "armi" "armature" "oggetti_magici" "talenti"}}
          <label class="checkbox-label">
            <input type="checkbox" name="collections" value="{{$collection}}" 
                   {{if and $.collections (contains $.collections $collection)}}checked{{end}}>
            <span>{{capitalize $collection}}</span>
          </label>
          {{end}}
        </div>
      </div>
    </form>
  </div>

  <!-- Search results -->
  <div id="search-results">
    {{if .results}}
    <div class="notion-list">
      {{range .results}}
      <div class="notion-list-item">
        <a href="/{{._collection}}/{{.slug}}" class="notion-list-item-link">
          <div class="notion-list-item-content">
            <h3 class="notion-list-item-title">{{.nome}}</h3>
            {{if .descrizione}}
            <p class="notion-list-item-description">
              {{if gt (len .descrizione) 200}}{{slice .descrizione 0 200}}...{{else}}{{.descrizione}}{{end}}
            </p>
            {{end}}
            <div class="notion-list-item-meta">
              <span class="tag">{{._collection_title}}</span>
              {{if .livello}}
              <span class="tag">Livello {{.livello}}</span>
              {{else if .grado_sfida}}
              <span class="tag">GS {{.grado_sfida}}</span>
              {{else if .costo}}
              <span class="tag">{{.costo}}</span>
              {{end}}
            </div>
          </div>
          <div class="notion-list-item-action">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M6.22 8.72a.75.75 0 0 0 1.06 1.06L10.94 6.2a.75.75 0 0 0-.53-1.28H6.75a.75.75 0 0 0 0 1.5h1.69L6.22 8.72Z"/>
            </svg>
          </div>
        </a>
      </div>
      {{end}}
    </div>
    {{else if .query}}
    <div class="notion-empty" style="text-align: center; padding: 2rem;">
      <p style="color: var(--notion-text-light); font-size: 1.1rem;">
        Nessun risultato trovato per "{{.query}}"
      </p>
      <p style="color: var(--notion-text-light); margin-top: 0.5rem;">
        Prova a modificare i termini di ricerca o seleziona collezioni diverse
      </p>
    </div>
    {{else}}
    <div class="notion-empty" style="text-align: center; padding: 2rem;">
      <p style="color: var(--notion-text-light); font-size: 1.1rem;">
        Inserisci un termine di ricerca per iniziare
      </p>
    </div>
    {{end}}
  </div>
</div>

<style>
.checkbox-label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.9rem;
  color: var(--notion-text);
  cursor: pointer;
}

.checkbox-label input[type="checkbox"] {
  margin: 0;
}

.filter-checkboxes {
  margin-top: 0.5rem;
}
</style>
{{end}}