{{define "search.html"}}
{{template "base.html" .}}
{{define "title"}}{{.title}}{{end}}
{{define "content"}}
<div class="notion-page">
  <div class="notion-page-header">
    <h1 style="color: var(--notion-text); font-size: 2rem; font-weight: 600; margin: 0;">
      {{.title}}
    </h1>
    {{if .query}}
    <p style="color: var(--notion-text-light); margin-top: 0.5rem;">
      Risultati per "{{.query}}"{{if .resultCount}} ({{.resultCount}} trovati){{end}}
    </p>
    {{end}}
  </div>

  <!-- Search form -->
  <div class="search-section" style="margin-bottom: 2rem;">
    <form hx-post="/search" hx-target="#search-results" hx-trigger="submit" class="search-form">
      <div class="search-input-container">
        <input name="q" type="text" placeholder="Cerca nel SRD..." 
               value="{{.query}}" class="field" style="flex: 1; margin-right: 10px;" required>
        <button type="submit" class="btn btn-primary">Cerca</button>
      </div>
      
      <!-- Collection filters -->
      <div class="search-filters" style="margin-top: 1rem;">
        <label style="color: var(--notion-text); font-weight: 500; margin-bottom: 0.5rem; display: block;">
          Cerca in:
        </label>
        <div class="filter-checkboxes" style="display: flex; flex-wrap: wrap; gap: 1rem;">
          {{$selectedCollections := .collections}}
          {{range $collection := (slice "incantesimi" "mostri" "classi" "backgrounds" "equipaggiamento" "armi" "armature" "oggetti_magici" "talenti")}}
          <label class="checkbox-label">
            <input type="checkbox" name="collections" value="{{$collection}}" 
                   {{if or (not $selectedCollections) (contains $selectedCollections $collection)}}checked{{end}}>
            <span>{{capitalize $collection}}</span>
          </label>
          {{end}}
        </div>
      </div>
    </form>
  </div>

  <!-- Search results -->
  <div id="search-results">
    {{if .results}}
    {{template "search_results.html" .}}
    {{else if .query}}
    <div class="notion-empty" style="text-align: center; padding: 2rem;">
      <p style="color: var(--notion-text-light); font-size: 1.1rem;">
        Nessun risultato trovato per "{{.query}}"
      </p>
      <p style="color: var(--notion-text-light); margin-top: 0.5rem;">
        Prova a modificare i termini di ricerca o seleziona collezioni diverse
      </p>
    </div>
    {{else}}
    <div class="notion-empty" style="text-align: center; padding: 2rem;">
      <p style="color: var(--notion-text-light); font-size: 1.1rem;">
        Inserisci un termine di ricerca per iniziare
      </p>
    </div>
    {{end}}
  </div>
</div>

<style>
.checkbox-label {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.9rem;
  color: var(--notion-text);
  cursor: pointer;
}

.checkbox-label input[type="checkbox"] {
  margin: 0;
}

.filter-checkboxes {
  margin-top: 0.5rem;
}
</style>
{{end}}
{{end}}