{{define "admin/collections.html"}}
{{template "base.html" .}}
{{define "title"}}{{.title}}{{end}}
{{define "content"}}
<div class="notion-page">
  <div class="notion-page-header">
    <div class="breadcrumb-nav" style="margin-bottom: 1rem;">
      <a href="/admin" class="breadcrumb-link">Admin</a>
      <span class="breadcrumb-separator">→</span>
      <span class="breadcrumb-current">{{.title}}</span>
    </div>
    
    <h1 style="color: var(--notion-text); font-size: 2rem; font-weight: 600; margin: 0;">
      {{.title}}
    </h1>
    <p style="color: var(--notion-text-light); margin-top: 0.5rem;">
      Gestione delle collezioni del database
    </p>
  </div>

  <!-- Collections Table -->
  <div class="notion-section">
    <div class="collections-table">
      <div class="table-header">
        <div class="table-row">
          <div class="table-cell header">Nome</div>
          <div class="table-cell header">Titolo</div>
          <div class="table-cell header">Elementi</div>
          <div class="table-cell header">Azioni</div>
        </div>
      </div>
      <div class="table-body">
        {{range .collections}}
        <div class="table-row">
          <div class="table-cell">
            <code class="collection-name">{{.name}}</code>
          </div>
          <div class="table-cell">
            <span class="collection-title">{{.title}}</span>
          </div>
          <div class="table-cell">
            <span class="collection-count">{{.count}}</span>
          </div>
          <div class="table-cell">
            <div class="action-buttons">
              <a href="/c/{{.name}}" class="btn btn-small btn-ghost" target="_blank">
                Visualizza
              </a>
              <button class="btn btn-small btn-secondary" 
                      hx-get="/admin/collection/{{.name}}/info"
                      hx-target="#collection-info-{{.name}}"
                      hx-indicator="#info-loading-{{.name}}">
                Info
              </button>
            </div>
            <div id="info-loading-{{.name}}" class="htmx-indicator">
              <span class="spinner-small"></span>
            </div>
            <div id="collection-info-{{.name}}" class="collection-info"></div>
          </div>
        </div>
        {{end}}
      </div>
    </div>
  </div>

  <!-- Bulk Actions -->
  <div class="notion-section" style="margin-top: 2rem;">
    <h2 style="color: var(--notion-text); font-size: 1.5rem; font-weight: 600; margin-bottom: 1rem;">
      Azioni Globali
    </h2>
    <div class="bulk-actions">
      <button class="btn btn-primary" 
              hx-post="/admin/collections/refresh"
              hx-target="#refresh-result"
              hx-indicator="#refresh-loading">
        Aggiorna Statistiche
      </button>
      <button class="btn btn-secondary" 
              hx-post="/admin/collections/validate"
              hx-target="#validate-result"
              hx-indicator="#validate-loading">
        Valida Integrità
      </button>
    </div>
    
    <div id="refresh-loading" class="htmx-indicator bulk-loading">
      <span class="spinner"></span> Aggiornamento statistiche...
    </div>
    <div id="validate-loading" class="htmx-indicator bulk-loading">
      <span class="spinner"></span> Validazione in corso...
    </div>
    
    <div id="refresh-result" class="bulk-result"></div>
    <div id="validate-result" class="bulk-result"></div>
  </div>

  <!-- Navigation -->
  <div class="notion-navigation" style="margin-top: 3rem; padding-top: 2rem; border-top: 1px solid var(--notion-border);">
    <a href="/admin" class="btn btn-secondary">← Torna all'Admin</a>
  </div>
</div>

<style>
.collections-table {
  background: var(--notion-card-bg);
  border: 1px solid var(--notion-border);
  border-radius: 8px;
  overflow: hidden;
}

.table-header {
  background: var(--notion-border);
}

.table-row {
  display: grid;
  grid-template-columns: 1fr 1fr 100px 200px;
  align-items: center;
}

.table-cell {
  padding: 1rem;
  border-bottom: 1px solid var(--notion-border);
}

.table-cell.header {
  font-weight: 600;
  color: var(--notion-text);
  background: var(--notion-bg);
  border-bottom: 2px solid var(--notion-border);
}

.table-row:last-child .table-cell {
  border-bottom: none;
}

.collection-name {
  font-family: 'SF Mono', Monaco, 'Cascadia Code', 'Roboto Mono', Consolas, 'Courier New', monospace;
  background: var(--notion-code-bg);
  padding: 0.25rem 0.5rem;
  border-radius: 4px;
  font-size: 0.875rem;
}

.collection-title {
  color: var(--notion-text);
  font-weight: 500;
}

.collection-count {
  color: var(--notion-text-light);
  font-weight: 500;
}

.action-buttons {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
}

.collection-info {
  margin-top: 0.5rem;
  padding: 0.75rem;
  background: var(--notion-code-bg);
  border-radius: 4px;
  font-size: 0.875rem;
  color: var(--notion-text-light);
  display: none;
}

.collection-info.show {
  display: block;
}

.bulk-actions {
  display: flex;
  gap: 1rem;
  flex-wrap: wrap;
}

.bulk-loading {
  display: none;
  margin-top: 1rem;
  align-items: center;
  color: var(--notion-text-light);
}

.bulk-result {
  margin-top: 1rem;
}

.htmx-request .htmx-indicator {
  display: flex;
}

.htmx-indicator .spinner,
.htmx-indicator .spinner-small {
  margin-right: 0.5rem;
}

.spinner-small {
  width: 12px;
  height: 12px;
  border: 2px solid var(--notion-border);
  border-top: 2px solid var(--notion-text-light);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@media (max-width: 768px) {
  .table-row {
    grid-template-columns: 1fr;
    gap: 0.5rem;
  }
  
  .table-cell.header {
    display: none;
  }
  
  .table-cell:before {
    content: attr(data-label);
    font-weight: 600;
    color: var(--notion-text-light);
    display: block;
    margin-bottom: 0.25rem;
  }
}
</style>

<script>
// Add data labels for mobile
document.addEventListener('DOMContentLoaded', function() {
  const headers = ['Nome', 'Titolo', 'Elementi', 'Azioni'];
  const rows = document.querySelectorAll('.table-body .table-row');
  
  rows.forEach(row => {
    const cells = row.querySelectorAll('.table-cell');
    cells.forEach((cell, index) => {
      cell.setAttribute('data-label', headers[index]);
    });
  });
});
</script>
{{end}}
{{end}}