{% if doc %}
<section id="doc-section" class="mt-6 bg-white border p-4">
  <article data-md-section>
    <!-- Unified sticky header: title, page num, prev/next titles -->
    <div class="sticky top-under-header z-10 -mx-2 px-2 py-1 bg-white/95 supports-[backdrop-filter]:bg-white/70 backdrop-blur border-b md:-mx-4 md:px-4">
      <div class="flex items-center justify-between gap-2">
        <div class="min-w-0">
          <div class="text-[11px] uppercase tracking-wide text-neutral-500">{{ doc.source or '' }}</div>
          <h2 class="text-base md:text-lg font-semibold break-words leading-snug">{{ doc.titolo or 'Documento' }}</h2>
          {% if pages_items and pages_items|length > 0 %}
          <nav class="mt-1 -mx-1 px-1 overflow-x-auto whitespace-nowrap flex items-center gap-1 text-[12px]" aria-label="Pagine">
            {% for it in pages_items %}
              {% set p = it.page %}
              {% set t = it.title %}
              {% if p == cur_page %}
                <span class="btn btn-dark !px-2 !py-0.5" aria-current="page" title="{{ t }}">{{ p }}</span>
              {% else %}
                <a class="btn !px-2 !py-0.5"
                   hx-get="/home/doc?page={{ p }}" hx-target="#doc-section" hx-swap="outerHTML" hx-push-url="/?page={{ p }}"
                   title="{{ t }}">{{ p }}</a>
              {% endif %}
            {% endfor %}
          </nav>
          {% elif pages_list and pages_list|length > 0 %}
          <nav class="mt-1 -mx-1 px-1 overflow-x-auto whitespace-nowrap flex items-center gap-1 text-[12px]" aria-label="Pagine">
            {% for p in pages_list %}
              {% if p == cur_page %}
                <span class="btn btn-dark !px-2 !py-0.5" aria-current="page">{{ p }}</span>
              {% else %}
                <a class="btn !px-2 !py-0.5"
                   hx-get="/home/doc?page={{ p }}" hx-target="#doc-section" hx-swap="outerHTML" hx-push-url="/?page={{ p }}"
                   title="Vai alla pagina {{ p }}">{{ p }}</a>
              {% endif %}
            {% endfor %}
          </nav>
          {% elif doc.numero_di_pagina %}
            <div class="text-[11px] text-neutral-500 leading-tight">Pagina {{ doc.numero_di_pagina }}</div>
          {% endif %}
        </div>
        <div class="flex items-stretch gap-2 shrink-0 flex-col sm:flex-row sm:items-center">
          <a class="btn text-xs whitespace-normal break-words leading-snug max-w-[12rem]"
             {% if prev_page %}
               hx-get="/home/doc?page={{ prev_page }}" hx-target="#doc-section" hx-swap="outerHTML" hx-push-url="/?page={{ prev_page }}"
             {% else %}
               aria-disabled="true" tabindex="-1" style="pointer-events:none;opacity:.5"
             {% endif %}
             title="{{ prev_title or 'Precedente' }}"
          >← Precedente</a>
          <a class="btn text-xs whitespace-normal break-words leading-snug max-w-[12rem]"
             {% if next_page %}
               hx-get="/home/doc?page={{ next_page }}" hx-target="#doc-section" hx-swap="outerHTML" hx-push-url="/?page={{ next_page }}"
             {% else %}
               aria-disabled="true" tabindex="-1" style="pointer-events:none;opacity:.5"
             {% endif %}
             title="{{ next_title or 'Successivo' }}"
          >Successivo →</a>
        </div>
      </div>
    </div>
    
    <div id="doc-md" data-markdown data-ssr="true" data-raw="{{ (doc.content or '') | e }}" class="prose max-w-none">{{ doc_html | safe }}</div>
  </article>
</section>
 
{% else %}
<section id="doc-section" class="mt-6 bg-white border p-4">
  <div class="text-sm text-neutral-600">Nessun documento disponibile.</div>
</section>
{% endif %}
