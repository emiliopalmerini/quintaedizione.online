<!-- _rows.html - HTMX template for collection rows -->
<div class="divide-y">
  {% for doc in documents %}
    {% set doc_name = doc.get('name') or doc.get('nome') or doc.get('title') or doc.get('titolo') or doc.get('slug') %}
    {% set doc_slug = doc.get('slug') or doc.get('name') or doc.get('nome') %}
    
    <a href="/show/{{ collection }}/{{ doc_slug }}{% if qs %}?{{ qs }}{% endif %}" 
       class="block px-4 py-3 hover:bg-neutral-50 text-inherit no-underline">
      <div class="flex items-center justify-between">
        <div class="flex-1">
          <h3 class="font-medium text-gray-900">
            {{ doc_name }}
          </h3>
          
          <div class="text-xs text-neutral-500 mt-1 flex flex-wrap items-center gap-2">
            {# Incantesimi - Level + School #}
            {% if doc.get('level') or doc.get('livello') %}
              <span>Livello {{ doc.get('level') or doc.get('livello') }}</span>
            {% endif %}
            {% if doc.get('school') or doc.get('scuola') %}
              <span>{{ doc.get('school') or doc.get('scuola') }}</span>
            {% endif %}
            
            {# Oggetti magici - Rarity + Type #}
            {% if doc.get('rarity') or doc.get('rarita') %}
              <span>{{ doc.get('rarity') or doc.get('rarita') }}</span>
            {% endif %}
            {% if doc.get('type') or doc.get('tipo') %}
              <span>{{ doc.get('type') or doc.get('tipo') }}</span>
            {% endif %}
            
            {# Mostri - Size + Type + CR #}
            {% if doc.get('size') or doc.get('taglia') %}
              <span>{{ doc.get('size') or doc.get('taglia') }}</span>
            {% endif %}
            {% if doc.get('challenge_rating') or doc.get('cr') or doc.get('gs') %}
              <span>GS {{ doc.get('challenge_rating') or doc.get('cr') or doc.get('gs') }}</span>
            {% endif %}
            
            {# Armi - Category + Damage + Properties #}
            {% if doc.get('category') or doc.get('categoria') %}
              <span>{{ doc.get('category') or doc.get('categoria') }}</span>
            {% endif %}
            {% if doc.get('damage') or doc.get('danno') %}
              <span>{{ doc.get('damage') or doc.get('danno') }}</span>
            {% endif %}
            {% if doc.get('properties') or doc.get('proprieta') %}
              <span>{{ doc.get('properties') or doc.get('proprieta') }}</span>
            {% endif %}
            
            {# Armature - Category + AC + Weight #}
            {% if doc.get('ac_base') or doc.get('ca_base') %}
              <span>CA {{ doc.get('ac_base') or doc.get('ca_base') }}</span>
            {% endif %}
            
            {# Strumenti - Category + Ability #}
            {% if doc.get('ability') or doc.get('caratteristica') %}
              <span>{{ doc.get('ability') or doc.get('caratteristica') }}</span>
            {% endif %}
            
            {# Servizi - Category + Cost #}
            {% if doc.get('cost') or doc.get('costo') %}
              <span>{{ doc.get('cost') or doc.get('costo') }}</span>
            {% endif %}
            
            {# Equipaggiamento - Weight + Cost #}
            {% if doc.get('weight') or doc.get('peso') %}
              <span>{{ doc.get('weight') or doc.get('peso') }}</span>
            {% endif %}
            
            {# Backgrounds - Skill proficiencies #}
            {% if doc.get('skill_proficiencies') or doc.get('competenze_abilita') %}
              <span>{{ doc.get('skill_proficiencies') or doc.get('competenze_abilita') }}</span>
            {% endif %}
            
            {# Specie - Size + Creature Type #}
            {% if doc.get('creature_type') or doc.get('tipo_creatura') %}
              <span>{{ doc.get('creature_type') or doc.get('tipo_creatura') }}</span>
            {% endif %}
            
            {# Talenti - Prerequisites or Category #}
            {% if doc.get('prerequisites') or doc.get('prerequisiti') %}
              <span>Prerequisiti: {{ doc.get('prerequisites') or doc.get('prerequisiti') }}</span>
            {% endif %}
            
            {# Classi - Primary Ability + Hit Die #}
            {% if doc.get('primary_ability') or doc.get('caratteristica_primaria') %}
              <span>{{ doc.get('primary_ability') or doc.get('caratteristica_primaria') }}</span>
            {% endif %}
            {% if doc.get('hit_die') or doc.get('dado_vita') %}
              <span>{{ doc.get('hit_die') or doc.get('dado_vita') }}</span>
            {% endif %}
            
            {# Documenti - Category + Page #}
            {% if doc.get('numero_di_pagina') %}
              <span>Pag. {{ doc.get('numero_di_pagina') }}</span>
            {% endif %}
          </div>
        </div>
        
        <div class="text-xs text-neutral-400">
          {% if doc.get('translated') %}
            <span class="text-green-600">✓ Tradotto</span>
          {% endif %}
        </div>
      </div>
    </a>
  {% endfor %}
  
  {% if not documents %}
    <div class="px-4 py-8 text-center text-neutral-500">
      <p>Nessun documento trovato.</p>
    </div>
  {% endif %}
</div>

<!-- Pagination -->
{% if total > page_size %}
<div class="px-4 py-3 border-t bg-neutral-50">
  <div class="flex items-center justify-between text-sm text-neutral-600">
    <div>
      Documenti {{ start_item }}-{{ end_item }} di {{ total }}
    </div>
    
    <div class="flex items-center space-x-2">
      {% if has_prev %}
        <button hx-get="/view/{{ collection }}?page={{ page - 1 }}{% if qs %}&{{ qs }}{% endif %}"
                hx-target="#rows"
                hx-include="closest form"
                class="px-3 py-1 bg-white border rounded hover:bg-neutral-50">
          ← Precedente
        </button>
      {% endif %}
      
      <span class="px-2">Pagina {{ page }} di {{ total_pages }}</span>
      
      {% if has_next %}
        <button hx-get="/view/{{ collection }}?page={{ page + 1 }}{% if qs %}&{{ qs }}{% endif %}"
                hx-target="#rows"
                hx-include="closest form"
                class="px-3 py-1 bg-white border rounded hover:bg-neutral-50">
          Successiva →
        </button>
      {% endif %}
    </div>
  </div>
</div>
{% endif %}